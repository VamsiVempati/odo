// Generated by IcedCoffeeScript 1.4.0c
(function() {
  var findplugin, fs, path, _;

  fs = require('fs');

  path = require('path');

  _ = require('underscore');

  findplugin = function(path, haystack) {
    var furtherpath, needle, plugin;
    if (path.length === 0) return haystack;
    if (haystack.plugins == null) return null;
    needle = path[0];
    furtherpath = path.slice(1);
    plugin = _(haystack.plugins).find(function(plugin) {
      return plugin.id === needle;
    });
    return findplugin(furtherpath, plugin);
  };

  module.exports = {
    init: function(app) {
      app.post('/%CF%88/plugins/:id', function(req, res) {
        var plugin;
        plugin = findplugin(req.params.id.split('.'), {
          id: 'root',
          plugins: app.plugins.root
        });
        if (plugin == null) {
          res.send(404);
          return;
        }
        if (req.body.disabled === 'true') {
          plugin.config.disabled = true;
        } else {
          delete plugin.config.disabled;
        }
        fs.writeFileSync(plugin.configpath, JSON.stringify(plugin.config, null, 2));
        return res.send('okay');
      });
      return app.get('/%CF%88/plugins/', function(req, res) {
        res.locals.plugins = app.plugins.root;
        return res.render({
          view: 'admin/layout',
          data: {
            title: 'Î¨ -> Enable and disable plugins',
            bodyclasses: ['prompt']
          },
          partials: {
            content: 'plugins/plugins'
          }
        });
      });
    }
  };

}).call(this);
