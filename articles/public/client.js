// Generated by IcedCoffeeScript 1.6.3-g
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };



  define(['jquery', 'odo/auth/twitter', 'uuid'], function($, twitterauth, uuid) {
    var ArticleLogic, areas;
    areas = ['Patterns & Practices', 'Leader of Men'];
    return ArticleLogic = (function() {
      function ArticleLogic() {
        this.deleteArticle = __bind(this.deleteArticle, this);
        this.createArticle = __bind(this.createArticle, this);
        this.getUrlForArticle = __bind(this.getUrlForArticle, this);
        this.getAreasForAutocomplete = __bind(this.getAreasForAutocomplete, this);
        this.getArticleForDisplay = __bind(this.getArticleForDisplay, this);
        this.getArticlesForAutocomplete = __bind(this.getArticlesForAutocomplete, this);
      }

      ArticleLogic.prototype.getArticlesForAutocomplete = function() {
        var _this = this;
        return $.Deferred(function(deferred) {
          return twitterauth.getUser(function(err, user) {
            var _this = this;
            if (err != null) {
              deferred.reject(err);
              return;
            }
            return $.get("user/" + user.id + "/articles").then(function(articles) {
              articles = articles.sort(function(a, b) {
                a = a.name.toLowerCase();
                b = b.name.toLowerCase();
                if (a < b) {
                  return -1;
                }
                if (a > b) {
                  return 1;
                }
                return 0;
              });
              return deferred.resolve(articles);
            }).fail(function(xhr, err) {
              return deferred.reject(err);
            });
          });
        }).promise();
      };

      ArticleLogic.prototype.getArticleForDisplay = function(id) {
        var _this = this;
        return $.Deferred(function(deferred) {
          return $.get("article/" + id).then(function(article) {
            article.url = _this.getUrlForArticle(article);
            return deferred.resolve(article);
          }).fail(function(xhr, err) {
            return deferred.reject(err);
          });
        }).promise();
      };

      ArticleLogic.prototype.getAreasForAutocomplete = function() {
        var _this = this;
        return $.Deferred(function(deferred) {
          return deferred.resolve(areas);
        }).promise();
      };

      ArticleLogic.prototype.getUrlForArticle = function(article) {
        return "articles/" + article.id + "/" + article.name;
      };

      ArticleLogic.prototype.createArticle = function(article) {
        var _this = this;
        return $.Deferred(function(deferred) {
          article.id = uuid.v1();
          return $.post("article/" + article.id, article).then(function() {
            return deferred.resolve();
          }).fail(function(xhr, err) {
            return deferred.reject(err);
          });
        }).promise();
      };

      ArticleLogic.prototype.deleteArticle = function(id) {
        var _this = this;
        return $.Deferred(function(deferred) {
          return $.ajax({
            url: "article/" + id,
            type: 'DELETE'
          }).then(function() {
            return deferred.resolve();
          }).fail(function(xhr, err) {
            return deferred.reject(err);
          });
        }).promise();
      };

      return ArticleLogic;

    })();
  });

}).call(this);
