// Generated by IcedCoffeeScript 1.4.0c
(function() {
  var app, config, express, fs, key, path, value, _ref,
    _this = this;

  path = require('path');

  express = require('express');

  fs = require('fs');

  app = express();

  config = config = JSON.parse(fs.readFileSync(path.join(__dirname, 'config.json'), 'utf-8'));

  app.plugins = require('./plugins');

  app.plugins.loadplugins(config.plugins.directories);

  _ref = config.config;
  for (key in _ref) {
    value = _ref[key];
    app.set(key, value);
  }

  app.configure(function() {
    var source, target, _ref1;
    app.use(express.compress());
    app.use(express.bodyParser());
    app.use(express.methodOverride());
    app.use(express.cookieParser(app.get('cookie secret')));
    app.use(express.cookieSession({
      key: app.get('session key'),
      secret: app.get('session secret')
    }));
    _ref1 = config.routes;
    for (source in _ref1) {
      target = _ref1[source];
      app.use(source, express["static"](__dirname + target));
    }
    app.plugins.configure(app);
    app.use(app.router);
    return app.use(express.errorHandler({
      dumpExceptions: true,
      showStack: true
    }));
  });

  app.plugins.init(app);

  app.listen(process.env.PORT || 80);

}).call(this);
